<!DOCTYPE html>
<html>
    <head>
        <% include ../partials/header.ejs %>
        <script src="/static/AppUtilities.js"></script>
        <script src="/static/d3.js"></script>
        <script src="/static/d3.layout.cloud.js"></script>
        <script src="/static/d3.wordcloud.js"></script>
    </head>

    <body onload="populateWordCloud();">

        <% include ../partials/navbar.ejs %>

        <div id="main_div">

            <div id="word_cloud_container" 
                class="w3-container w3-padding-large w3-twothird w3-left">
                <div id="word_cloud" class="svg-container"></div>
            </div>
            
            <div class="w3-container w3-third w3-padding-large w3-right" 
                >

                <form class="w3-padding-large w3-center" id="login_form" method="post">
                
                    <label for="username"> Username: </label>
                    <input class="w3-input" type="text" name="username" 
                        pattern="[_\-A-Za-z0-9]+" required/>
                
                    <br />
                    <br />
                
                    <label for="password"> Password: </label>
                    <input class="w3-input" type="password" name="password" 
                        minlength="8" required/>
                
                    <br />
                    <br />
                
                    <button class="w3-button w3-center w3-green" type="submit" 
                        onclick="return logInUser('login_form', '/login')">Log In</button>
                    
                    <br />
                    <br />

                    <button class="w3-button w3-center w3-blue" 
                        onclick="return displayForm('signup_form')">
                        ... or Sign Up for a New Account</button>

                </form>

                <form class="w3-padding-large w3-center hidden" id="signup_form" method="post">

                    <label for="email">Email Address: </label>
                    <input class="w3-input" type="email" name="email" 
                        required/>

                    <br />
                    <br />
                    
                    <label for="username"> Choose an alphanumeric username: </label>
                    <input class="w3-input" type="text" name="username" 
                        pattern="[_\-A-Za-z0-9]+" required/>
                    
                    <br />
                    <br />
                    
                    <label for="password"> Choose a password: </label>
                    <input class="w3-input" type="password" name="password" 
                        minlength="8" required/>
                    
                    <br />
                    <br />
                    
                    <button class="w3-button w3-center w3-green" type="submit" 
                        onclick="return logInUser('signup_form', '/register-user')">Sign Up</button>
                    
                    <br />
                    <br />

                    <button class="w3-button w3-center w3-blue" 
                        onclick="return displayForm('login_form')">
                        ... or go back to LogIn</button>
                </form>

            </div>

        </div>
        
        
        <footer class="w3-container w3-container w3-black">
            <% include ../partials/footer.ejs %>
        </footer>

        <script type="text/javascript">

            /*
             * @description Toggle the form being displayed.
             * @param {string} form_id The ID of the form to be displayed.
             * 
             */
            function displayForm(form_id) {
                if (form_id === "signup_form") {
                    document.getElementById("login_form").style.display = "none";
                    document.getElementById("signup_form").style.display = "block";
                } else if (form_id === "login_form") {
                    document.getElementById("signup_form").style.display = "none";
                    document.getElementById("login_form").style.display = "block";
                }
                return false;
            }

            /*
             * @description Log in the user.
             * @param {string} formID The ID of the form that has credentials
             * @param {string} url The URL at which the form will be processed
             */
            function logInUser(formID, url) {
                sendForm(formID, url, (results) => {
                    if (results.success) {
                        localStorage.setItem(
                            "metadata", JSON.stringify(results.message)
                        );
                        window.location = "/home";
                    } else if (!results.internal_error) {
                        alert(results.message);
                    }
                });

                return false;
            }

            /*
             * Set up the Word Cloud
             */
            function populateWordCloud() {
                var word_cloud_element = document.getElementById("word_cloud");
                var width = word_cloud_element.clientWidth;
                var height = 500;
                sendHTTPRequest("POST", "/tags", {createdById: 1}, (words) => {
                    d3.wordcloud()
                        .size([width, height])
                        .selector("#word_cloud")
                        .scale("log") // Options: sqrt, log, linear
                        .spiral("archimedean") // Options: archimedean, rectangular
                        .words(words)
                        .start();
                })   
            }
            
        </script>

    </body>
    
</html>