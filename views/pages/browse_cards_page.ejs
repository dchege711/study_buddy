<!DOCTYPE <!DOCTYPE html>
<html>
    <head>
        <% include ../partials/header.ejs %>
        <title><%= appName %>: Browse/Search</title>
        <script src="/static/AppUtilities.js"></script>
        <link rel="stylesheet" href="/stylesheets/themes/atom-one-light.css">
        <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script type="text/javascript" src="/static/CardTemplateController.js"></script>
        <script type="text/javascript" src="/static/CardsManager.js"></script>
        <script type="text/javascript" src="/static/showdown.min.js"></script>
        <script type="text/javascript" async src="/static/highlight.pack.js"></script>

        <style>
            .box {
                display: flex;
                flex-flow: row wrap;
                align-items: stretch;
            }

            div#card_container_holder {
                border: solid blue;
                z-index: 3; /* On top of the search results */
                position: absolute;
                display: block;
                min-width: 80%;
                margin-left: 10%;
                margin-right: 10%;
                top: 30%;
                visibility: hidden;
            }

            div.search-result {
                cursor: pointer;
            }

            div#card_container_holder:focus {
                visibility: visible;
            }

            div#card_container_holder:not(.focus) {
                visibility: hidden;
            }

            div#temp_container {
                border: thick solid red;
            }

        </style>
    </head>

    <body>
        <% include ../partials/navbar.ejs %>

        <div id="main_div">
            <div class="w3-container" id="search_div">

                <form method="GET">
                    <div class="dropdown w3-threequarter">
                        <input type="text" id="search_input" placeholder="Search for cards, e.g. dynamic programming" 
                            onkeyup="handleSearchInputChange(event);" class="w3-input dropbtn" name="query_string" />
                        <div class="dropdown-content" id="search_autocomplete_results"></div>
                    </div>
                    <input type="submit" class="w3-quarter w3-btn w3-blue" value="Search for Cards"></button>

                </form>

            </div>

            <div class="w3-container" id="temp_container">
    
                <div class="w3-container box" id="search_results">
                    <% if (abbreviatedCards.length === 0) { %>
                        <div class="w3-container">
                            <p>No cards found.</p>
                        </div>
                    <% } else { %>
                        <% for (let i = 0; i < abbreviatedCards.length; i++) { %>
                            <div class="w3-card-4 w3-padding-small w3-margin search-result" onclick="displayFullCard('<%= abbreviatedCards[i]._id %>')">
                                <header class="w3-container w3-blue"><h4><%= abbreviatedCards[i].title %></h4></header>
                                <div class="w3-container"><p><strong>Tags: </strong><%= abbreviatedCards[i].tags %></p></div>
                            </div>
                        <% } %>
                    <% } %>
                </div>

                <div id="card_container_holder">
                    <% include ../partials/search_result_card_template.ejs %>
                </div>

            </div>

        </div>

    </body>

    <script type="text/javascript">

        let searchInputElement = document.getElementById("search_input");
        let cardContainerHolder = document.getElementById("card_container_holder");
    
        function handleSearchInputChange() {
            state.queryString = searchInputElement.value;
        }

        function displayFullCard(card_id) {
            cardContainerHolder.style.visibility = "visible";
        }

        function closeFullCardWindow() {
            cardContainerHolder.style.visibility = "hidden";
        }

    </script>

</html>