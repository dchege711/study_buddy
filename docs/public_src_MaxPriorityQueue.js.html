<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: public/src/MaxPriorityQueue.js | Cards by c13u Docs</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: public/src/MaxPriorityQueue.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Implements a max priority queue with a binary heap.
 * Allows us to maintain a sorted deck of N items in log N time.
 * Adapted from https://algs4.cs.princeton.edu/code/edu/princeton/cs/algs4/MaxPQ.java.html
 * 
 * @class
 */
function max_PQ() {
    
    /**
     * Holds the class for the max PQ 'class'
     */
    var pq_object = {};

    var pq = [];
    var n = 0;
    var keys_insertion_order = {};

    /* An ever-increasing variable that allows stable sorting in the PQ */
    var insert_order_id = 0; // We're not famous enough for an overflow problem

    /**
     * @description Initialize the max PQ data structure.
     * @param {Array} keys_and_weights Array of (key, weight) tuples
     */
    pq_object.initialize = function(keys_and_weights) {
        n = keys_and_weights.length;
        pq = Array(n + 1).fill([null, Number.NEGATIVE_INFINITY]);

        for (var i = 0; i &lt; n; i++) {
            keys_insertion_order[keys_and_weights[i][0]] = insert_order_id;
            pq[i+1] = keys_and_weights[i];
            insert_order_id += 1;
        }

        for (var k = Math.floor(n/2); k >= 1; k--) {
            sink(k);
        }

        // console.assert(is_max_heap(1), "Max Heap invariant has been broken");
    };

    /**
     * @description Check whether the PQ is empty
     * @returns {Boolean} `true` if empty, `false` otherwise.
     */
    pq_object.is_empty = function() {
        return n === 0;
    };

    /**
     * @description Return the number of items in the PQ
     * @returns {Number} The number of items in the PQ
     */
    pq_object.size = function() {
        return n;
    };

    /**
     * @description Return `true` iff the specified key exists in the PQ
     * @param {String} key The key of the item being queried
     */
    pq_object.contains_key = function(key) {
        return keys_insertion_order.hasOwnProperty(key);
    };

    /**
     * @description Insert `key_and_weight` into the priority queue.
     * @param {Array} key_and_weight A tuple representing the key of the value
     * to be inserted, and its weight relative to what's in the PQ.
     */
    pq_object.insert = function(key_and_weight) {
        if (n === pq.length - 1) resize(2 * pq.length);
        
        n = n + 1;
        if (keys_insertion_order.hasOwnProperty(key_and_weight[0]) === false) {
            keys_insertion_order[key_and_weight[0]] = insert_order_id;
            insert_order_id += 1;
        }
        pq[n] = key_and_weight;
        swim(n);
        // console.assert(is_max_heap(1), "Max Heap invariant has been broken");
    };

    /**
     * @description Delete the item that has the most weight in the PQ.
     */
    pq_object.del_max = function() {
        if (this.is_empty()) return [null, Number.NEGATIVE_INFINITY];

        var max = pq[1];
        exchange(1, n);
        n = n - 1;
        sink(1);
        pq[n + 1] = [null, Number.NEGATIVE_INFINITY];

        if ((n > 0) &amp;&amp; (n === Math.floor((pq.length - 1) / 4))) 
            resize(Math.floor(pq.length / 2));
        // console.assert(is_max_heap(1), "Max Heap invariant has been broken");
        
        delete keys_insertion_order[max[0]];
        return max;
    };

    /**
     * @description Return the item at the top of the PQ, but don't 
     * delete it.
     */
    pq_object.peek = function() {
        if (n === 0) return null;
        return pq[1];
    };

    /**
     * @description Increase/descrease the underlying array for the PQ. 
     * We're currently doubling the size at half capacity, and halving 
     * at quarter capacity.
     * @param {Number} capacity The new capacity of the PQ
     */
    function resize(capacity) {
        // console.assert(capacity > n);
        var newPQ = Array(capacity).fill([null, Number.NEGATIVE_INFINITY]);
        for (var i = 0; i &lt;= n; i++) {
            newPQ[i] = pq[i];
        }
        pq = newPQ;
    }

    /**
     * @description Move the item at the k'th index up the PQ in order to 
     * maintain heap invariant.
     * @param {Number} k The index of the item that needs to be relocated.
     */
    function swim(k) {
        // console.assert(is_int(k));
        while (k > 1 &amp;&amp; less(Math.floor(k/2), k)) {
            exchange(k, Math.floor(k/2));
            k = Math.floor(k/2);
        }
    }

    /**
     * @description Move the item at the k'th index down the PQ in order to 
     * maintain heap invariant.
     * @param {Number} k The index of the item that needs to be relocated.
     */
    function sink(k) {
        // console.assert(is_int(k));
        while (2 * k &lt;= n) {
            var j = 2 * k;
            if (j &lt; n &amp;&amp; less(j, j+1)) j++;
            if (!less(k, j)) break;
            exchange(k, j);
            k = j;
        }
    }

    /**
     * @description Compare the item at index `i` with the one at index `j`.
     * @param {Number} i The index of the first item
     * @param {Number} j The index of the second item
     * @returns {Boolean} `true` if the item at `i` is strictly less than 
     * the one at `j`.
     */
    function less(i, j) {
        // console.assert(is_int(i));
        // console.assert(is_int(j));
        if (pq[i][1] !== pq[j][1]) return pq[i][1] &lt; pq[j][1];
        else return keys_insertion_order[pq[i][0]] &lt; keys_insertion_order[pq[j][0]];
    }

    /**
     * @description Swap the item at index `i` with the one at index `j`
     * @param {Number} i The index of the first item
     * @param {Number} j The index of the second item
     */
    function exchange(i, j) {
        // console.assert(is_int(i));
        // console.assert(is_int(j));

        var swap = pq[i];
        pq[i] = pq[j];
        pq[j] = swap;
    }

    /**
     * @param {Number} x The number that needs to be checked
     * @returns {Boolean} `true` if `x` is an integer, `false` otherwise
     */
    function is_int(x) {
        return Math.floor(x) === x;
    }

    /**
     * @param {Number} k The index of the item at the root of the (sub)tree
     * @returns {Boolean} `true` if the subtree rooted at satisfies the heap
     * order invariant, `false` otherwise.
     */
    function is_max_heap(k) {
        if (k > n) return true;
        var left = 2*k;
        var right = 2*k + 1;
        if (left &lt;= n &amp;&amp; less(k, left)) return false;
        if (right &lt;= n &amp;&amp; less(k, right)) return false;
        return is_max_heap(left) &amp;&amp; is_max_heap(right);
    }

    /**
     * Return an iterator over all items in the PQ
     */
    pq_object[Symbol.iterator] = function* () {
        // MDN: Object.assign(...) copies the reference values
        // JSON.parse(JSON.stringify(pq_object)) loses functions.
        let original_pq = [];
        for (var i = 0; i &lt; pq.length; i++) {
            if (pq[i][0]) {
                original_pq.push(pq[i]);
            }
        }

        while (!this.isEmpty()) {
            yield this.delMax();
        }

        this.initialize(original_pq);
    };

    return pq_object;
}

/**
 * Sanity check...
 */
if (typeof require !== "undefined" &amp;&amp; require.main === module) {
    var testPQ = maxPQ();
    var keys_and_weights = [
        ["one", 1], ["five", 5], ["two", 2], 
        ["three", 3], ["zero", 0], ["four", 4] 
    ];
    testPQ.initialize(keys_and_weights);

    console.log("Expect to see 6 items in descending order");
    for (let item of testPQ) {
        console.log(item);
    }

    console.log("Size should be 6: " + testPQ.size());

    testPQ.insert(["ten", 10]);
    testPQ.insert(["twenty", 20]);
    testPQ.insert(["-ve one", -1]);

    console.log("Size should be 9: " + testPQ.size());

    console.log("Expect to see 9 items in descending order");
    for (let item of testPQ) {
        console.log(item);
    }
}

module.exports = max_PQ;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Wiki</h3><ul><li><a href="tutorial-main._readme.html">The Main Page</a></li><li><a href="tutorial-meta._readme.html">Miscellaneous</a></li><li><a href="tutorial-user._readme.html">The User Account</a></li></ul><h3>Modules</h3><ul><li><a href="module-models_CardsMongoDB.html">models/CardsMongoDB</a></li><li><a href="module-models_DailyTasks.html">models/DailyTasks</a></li><li><a href="module-models_EmailClient.html">models/EmailClient</a></li><li><a href="module-models_LogInUtilities.html">models/LogInUtilities</a></li><li><a href="module-models_MetadataMongoDB.html">models/MetadataMongoDB</a></li><li><a href="module-models_Miscellaneous.html">models/Miscellaneous</a></li><li><a href="module-models_mongoose_models_CardSchema.html">models/mongoose_models/CardSchema</a></li><li><a href="module-models_mongoose_models_MetadataCardSchema.html">models/mongoose_models/MetadataCardSchema</a></li><li><a href="module-models_mongoose_models_Token.html">models/mongoose_models/Token</a></li><li><a href="module-models_mongoose_models_UserSchema.html">models/mongoose_models/UserSchema</a></li><li><a href="module-models_MongooseClient.html">models/MongooseClient</a></li><li><a href="module-models_SanitizationAndValidation.html">models/SanitizationAndValidation</a></li><li><a href="module-public_src_AppUtilities.html">public/src/AppUtilities</a></li><li><a href="module-public_src_CardTemplateUtilities.html">public/src/CardTemplateUtilities</a></li><li><a href="module-public_src_TagsBarUtilities.html">public/src/TagsBarUtilities</a></li></ul><h3>Classes</h3><ul><li><a href="AutoComplete.html">AutoComplete</a></li><li><a href="CardsManager.html">CardsManager</a></li><li><a href="Graph.html">Graph</a></li><li><a href="max_PQ.html">max_PQ</a></li><li><a href="TernarySearchTrie.html">TernarySearchTrie</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sat Sep 21 2019 11:24:18 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
